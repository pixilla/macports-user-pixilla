# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

set version_mysql   5
set name_package    lib_mysqludf_xql
name                mysql${version_mysql}-${name_package}
version             1.0.0
distname            ${name_package}-${version}
categories          databases lang
maintainers         pixilla
platforms           darwin

description         The lib_mysqludf_xql library provides an array of functions, which can be used \
                    to create XML output directly from MySQL using a single SQL query.
long_description    ${description} This prevents having to convert a MySQL result to XML in a PHP \
                    script, Ruby script, etc. This improves performance and simplifies your code. \
                    \
                    The library provides the same functionality as SQL/XML, seen in MS SQL server \
                    and Oracle. However it uses normal functions. By using subqueries the same \
                    results as SQL/XML can be generated.

homepage            http://www.mysqludf.org/${name_package}/
master_sites        ${homepage}

checksums           sha1    5650c5daa67b80f90ba8d5a978c3f0baff470243 \
                    rmd160  6750ca0e97ee096194c33703d0b35b645920a0ee

depends_lib-append  path:${prefix}/lib/mysql${version_mysql}/bin/mysql_config:mysql${version_mysql} \
                    port:libxml2

configure.args-append \
                    --with-libxml2=${prefix}/lib/xml2Conf.sh \
                    --with-mysql=${prefix}/lib/mysql${version_mysql}/bin/mysql_config \
                    --with-mysqlbin=${prefix}/bin/mysql${version_mysql} \
                    --with-mysqladmin=${prefix}/bin/mysqladmin${version_mysql} \
                    --with-mysqltest=${prefix}/bin/mysqltestc${version_mysql}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/mysql${version_mysql}/${name_package}
    xinstall -m 644 -W ${worksrcpath} \
        API AUTHORS COPYING ChangeLog INSTALL NEWS README installdb.sql uninstalldb.sql \
        ${destroot}${prefix}/share/mysql${version_mysql}/${name_package}
    copy ${worksrcpath}/test \
        ${destroot}${prefix}/share/mysql${version_mysql}/${name_package}
}

livecheck.url       ${master_sites}
livecheck.type      regex
livecheck.regex     "${name_package}-(\\d+\\.\\d+(\[\\drc.\]+)?)${extract.suffix}"

notes "

    This port installs two mysql scripts to simplify the install/uninstall of the ${name_package}
    UDFs (user-defined-functions).
    
    Install:
    \$ ${prefix}/bin/mysql${version_mysql} -uroot -p < ${prefix}/share/mysql${version_mysql}/${name_package}/installdb.sql

    Uninstall:
    \$ ${prefix}/bin/mysql${version_mysql} -uroot -p < ${prefix}/share/mysql${version_mysql}/${name_package}/uninstalldb.sql
    
    API:
    $ cat ${prefix}/share/mysql${version_mysql}/${name_package}/API
    "
    
