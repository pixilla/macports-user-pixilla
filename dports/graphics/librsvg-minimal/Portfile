# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           archcheck 1.0

name                librsvg-minimal
conflicts           librsvg
set name_package    librsvg
version             2.34.2
license             {GPL-2+ LGPL-2+}
set branch          [join [lrange [split ${version} .] 0 1] .]
categories          graphics gnome
platforms           darwin
maintainers         pixilla openmaintainer
description         Gnome implementation of rsvg.
long_description    ${description}

homepage            http://librsvg.sourceforge.net/
master_sites        gnome:sources/${name_package}/${branch}/
use_bzip2           yes

distname            ${name_package}-${version}

checksums           rmd160  008ac1d2f31717f03ad16a51ba5ffdabdae66d40 \
                    sha256  f27aace8592ef43202cba240fe760ac1cdd3422ea16ce0fad9704d850bed9b76

depends_build       port:pkgconfig

depends_lib         port:gdk-pixbuf2 \
                    port:libxml2 \
                    port:pango \
                    port:libcroco
                    
configure.args      --prefix=${prefix} \
                    --with-croco \
                    --with-svgz \
                    --enable-pixbuf-loader \
                    --disable-gtk-theme

set buildpath       ${worksrcpath}/macports
post-build {
    xinstall -d ${buildpath}
    set fp [open ${buildpath}/svg2pdf w]
    puts $fp "#!/bin/sh"
    puts $fp "if \[ \$# -lt 2 -o \"\$1\" = \"-h\" -o \"\$1\" = \"--help\" \] ; then"
    puts $fp "	echo \"FAIL: usage: \$0 input_file.svg output_file.pdf\""
    puts $fp "	exit 255;"
    puts $fp "fi"
    puts $fp "rsvg-convert -f pdf -o \"\$2\" \"\$1\""
    close $fp
}

post-destroot {
    set docdir ${prefix}/share/doc/${name_package}
    xinstall -d ${destroot}${docdir}
    xinstall -m 644 -W ${worksrcpath} AUTHORS COPYING COPYING.LIB NEWS README \
        ${destroot}${docdir}
    xinstall -m 755 -W ${buildpath} svg2pdf \
        ${destroot}${prefix}/bin
}

post-activate {
    ui_debug "Updating gdk-pixbuf.loaders..."
    system "${prefix}/bin/gdk-pixbuf-query-loaders --update-cache"
}

livecheck.type      regex
livecheck.url       http://ftp.gnome.org/pub/gnome/sources/${name_package}/${branch}/
livecheck.regex     {LATEST-IS-(\d+(?:\.\d+)*)}
